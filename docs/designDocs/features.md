# 機能仕様書

## 概要
`valiv` CLIツールが提供する機能と、その振る舞いについて定義します。

## コマンド一覧

### 1. `init`
初期設定を行います。
- **機能**: ユーザーにウェルカムメッセージを表示し、vα-liv公式メンバー（灯里愛夏、上水流宇宙、レトラ、公式）の一括登録を提案します。その後、任意のクリエイター登録（`add`コマンド相当）を促します。
- **使用法**: `valiv init`

### 2. `add`
追跡対象のクリエイター（推し）を新規登録します。
- **機能**: 対話形式で以下の情報を入力させ、設定ファイルに保存します。
    - 名前 (必須)
    - YouTube Channel ID (任意)
    - Twitch Channel ID (任意)
    - X Username (任意)
    - Google Calendar iCal URL (任意)
- **使用法**: `valiv add`

### 3. `remove`
登録済みのクリエイターを削除します。
- **機能**: 登録されているクリエイターの一覧を表示し、選択したクリエイターを削除します。
- **使用法**: `valiv remove`

### 4. `list`
登録済みのクリエイター一覧を表示します。
- **機能**: 登録されているクリエイターの名前と各サービスのID設定状況を表形式で表示します。
- **引数**:
    - `--detail` (`-d`): 詳細情報を表示します。
    - `--interactive` (`-i`): インタラクティブモードを有効にします。
- **使用法**:
    - `valiv list`
    - `valiv list --detail`
    - `valiv list --interactive`

### 5. `check`
クリエイターの最新の活動状況を確認します。
- **機能**:
    - 登録された全クリエイター（または指定されたクリエイター）のYouTube更新情報を取得します。
    - 結果を時系列順（新しい順）にソートして表示します。
    - **インタラクティブモード**:
        - `↑` `↓` キーでリスト内をナビゲートできます。
        - `Enter` キーで選択したアクティビティを再生します。
    - **動画再生**:
        - `mpv` がシステムにインストールされている場合、`node-mpv` を使用して直接再生します。
        - `mpv` が利用できない場合、デフォルトブラウザでURLを開きます。
        - `--audio-only` (`-a`) オプション:
            - 映像ウィンドウを表示せず、音声のみを再生します。
            - 再生中はCLIが待機状態となり、`q` キーで停止・終了できます。
        - `--debug` (`-d`) オプション:
            - `valiv_debug.log` ファイルに詳細なログを出力します。
            - `yt-dlp` の verbose ログも含まれます。
    - 現状はYouTubeのRSSフィードを利用して直近の動画/配信を取得します。
- **引数**:
    - `id` (任意): 特定のクリエイターのみチェックする場合に指定。
        - **マッチング仕様**:
            - 部分一致 (Substring match)
            - 大文字・小文字を区別しない (Case-insensitive)
            - スペース区切りで複数キーワード指定可能 (AND検索)
            - 検索対象: 名前 (Name), ID, X Username
- **使用法**:
    - `valiv check`
    - `valiv check "Creator Name"`
    - `valiv check "tomori manaka"` (キーワード検索)

### 6. `schedule`
クリエイターの今後のスケジュールを確認します。
- **機能**:
    - Google Calendar (iCal) が登録されているクリエイターの予定を取得します。
    - 現在時刻以降のイベントを抽出し、開始日時順に表示します。
- **引数**:
    - `id` (任意): 特定のクリエイターのみチェックする場合に指定。
        - **マッチング仕様**: `check` コマンドと同様。
- **使用法**:
    - `valiv schedule`

### 7. `open`
クリエイターの各サービスページをブラウザで開きます。
- **機能**: 指定されたプラットフォームのURLを生成し、デフォルトブラウザで開きます。
- **引数**:
    - `name` (必須): クリエイター名
    - `platform` (必須): `youtube`, `twitch`, `x` のいずれか
- **使用法**:
    - `valiv open "Creator Name" youtube`

## 外部サービス連携仕様

### YouTube
- **取得方法**: チャンネルRSSフィード (`https://www.youtube.com/feeds/videos.xml?channel_id=...`)
- **認証**: 不要
- **制限**: RSSには直近の15件程度の動画/配信アーカイブのみが含まれます。予定されている配信は含まれない場合があります。

### Google Calendar
- **取得方法**: 公開カレンダーのiCal形式 (.ics) URL
- **認証**: 不要（公開設定であること）
- **処理**: iCal形式のデータをパースし、直近の予定を抽出します。

### X / Twitch
- **現状**: API制限および認証の複雑さを避けるため、`open` コマンドによるブラウザ遷移のみサポートしています。
- **将来展望**: 公式APIまたはスクレイピングによる情報取得の検討。

## 設定ファイル
- **場所**: `~/.config/valiv/config.json` (OSにより異なる場合があります)
- **形式**: JSON
- **内容**: 登録クリエイターのリスト
